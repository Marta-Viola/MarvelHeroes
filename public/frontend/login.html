<!DOCTYPE html>
<html lang="it" class="h-100">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <title>MarvelHeroes - Login</title>
        <link href="/frontend/css/login.css" rel="stylesheet">
    </head>
    <body class="d-flex text-center bg-darkred h-100 w-100">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
        <div class="p-3 mx-auto flex-column d-flex w-100 h-100">
            <header class="mb-auto">
                <div>
                    <h3 class="float-md-start mv-0">MarvelHeroes</h3>
                    <nav class="nav nav-masthead justify-content-center float-md-end">
                        <a class="nav-link active text-white" aria-current="page" href="#">Home</a>
                        <a class="nav-link text-white" href="">Iscriviti</a>
                        <a class="nav-link text-white" href="">Accedi</a>
                    </nav>
                </div>
            </header>
            <main class="px-3">
                <form class="px-5" id="loginForm">
                    <h1 class="h3 mb-3 fw-normal">Vuoi Accedere?</h1>
                    <div class="form-floating m-1">
                        <input type="email" class="form-control" id="floatingInput" placeholder="name@example.com">
                        <label for="floatingInput">email</label>
                    </div>
                    <div class="form-floating m-1">
                        <input type="password" class="form-control" id="floatingPassword" placeholder="Password">
                        <label for="floatingPassword">password</label>
                    </div>
                    <div class="m-1 form-floating">                    
                        <button class="btn btn-lg fw-bold bg-white w-100" type="submit">Accedi</button>
                    </div>
                </form>
            </main>
            <footer class="mt-auto text-white-50">
                <p>
                   Creato da Marta Viola Manzari
                </p>
            </footer>
        </div>

        <script>
            document.getElementById('loginForm').addEventListener('submit', async function (event) {
                event.preventDefault(); //Evita il comportamento predefinito del form

                //Raccogli i dati del form
                const username = document.getElementById('floatingInput').value;
                const password = document.getElementById('floatingPassword').value;

                try {
                    //Invio della richiesta POST al server
                    const response = await fetch('http://127.0.0.1:3000/login', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({ username, password })
                    });

                    if (!response.ok) {
                        //Se il server restituisce un errore
                        const errorText = await response.text();
                        alert('Errore nel login: ' + errorText);
                        return;
                    }

                    //Riceve il token JWT dal server
                    const data = await response.json();
                    const token = data.token;

                    //Salva il token JWT nel local storage
                    localStorage.setItem('jwtToken', token);

                    //Redirrect alla homepage
                    window.location.href = 'http://127.0.0.1:3000/homepage.html';    //configura la route /home
                } catch (error) {
                    console.error('Errore durante il login:' , error);
                    alert('Errore durante il login. Controlla la console per maggiori dettagli.');
                }
            });
        </script>
    </body>
</html>