<!DOCTYPE html>
<html lang="it" class="h-100">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
        <title>MarvelHeroes - Signup</title>
        <link href="/css/login.css" rel="stylesheet">
    </head>
    <body class="d-flex text-center bg-darkred h-100 w-100">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
        <div class="p-3 mx-auto flex-column d-flex w-100 h-100">
            <header class="mb-auto">
                <div>
                    <h3 class="float-md-start mv-0">MarvelHeroes</h3>
                    <nav class="nav nav-masthead justify-content-center float-md-end">
                        <a class="nav-link active text-white" aria-current="page" href="#">Home</a>
                        <a class="nav-link text-white" href="">Iscriviti</a>
                        <a class="nav-link text-white" href="">Accedi</a>
                    </nav>
                </div>
            </header>
            <main class="px-3">
                <form class="px-5" id="registrationForm">
                    <h1 class="h3 mb-3 fw-normal">Vuoi Iscriverti?</h1>
                    <div class="form-floating m-1">
                        <input type="text" class="form-control" id="floatingName" placeholder="MarvelFan" required>
                        <label for="floatingName">username</label>
                        <div class="invalid-feedback">Il campo username è obbligatorio.</div>
                    </div>
                    <div class="form-floating m-1">
                        <input type="email" class="form-control" id="floatingInput" placeholder="name@example.com" required>
                        <label for="floatingInput">email</label>
                        <div class="invalid-feedback">Il campo email è obbligatorio.</div>
                    </div>
                    <div class="form-floating m-1">
                        <input type="password" class="form-control" id="floatingPassword" placeholder="Password" required>
                        <label for="floatingPassword">password</label>
                        <div class="invalid-feedback">Il campo pasasword è obbligatorio</div>
                    </div>
                    <div class="form-floating m-1">
                        <input type="text" class="form-control" id="floatingHero" placeholder="Iron Man" required>
                        <label for="floatingHero">il tuo eroe preferito!</label>
                        <div class="invalid-feedback">Il campo eroe preferito è obbligatorio</div>
                    </div>
                    <div class="m-1 form-floating">                    
                        <button class="btn btn-lg fw-bold bg-white w-100" type="submit">Iscriviti</button>
                    </div>
                </form>
            </main>
            <footer class="mt-auto text-white-50">
                <p>
                   Creato da Marta Viola Manzari
                </p>
            </footer>
        </div>
        <script src="/index.js"></script>
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const form = document.getElementById('registrationForm');

                form.addEventListener('submit', function(event) {
                    event.preventDefault();

                    let isValid = true;

                    form.querySelectorAll('input').forEach(input => {
                        if (!input.checkValidity()) {
                            input.classList.add('is-invalid');
                            isValid = false;
                        } else {
                           input.classList.remove('is-invalid'); 
                        }
                    });

                    if (isValid) {
                        const userData = {
                            username: document.getElementById('floatingName').value,
                            password: document.getElementById('floatingPassword').value,
                            email: document.getElementById('floatingInput').value,
                            hero: document.getElementById('floatingHero').value
                        };

                        fetch('/signup', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify(userData)
                        })
                        .then(response => {
                            console.log('HTTP Status:', response.status);
                            return response.json();
                        })
                        .then(data => {
                            if (data.error) {
                                alert('Errore nella registrazione: ' + data.error);
                            } else {
                                alert('Registrazione completata con successo!');
                                //window.location.href = data.redirect;
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                            alert('Errpre durante la registrazione.');
                        });
                    }
                });

                form.querySelectorAll('input').forEach(input => {
                    input.addEventListener('input', function() {
                        if (input.checkValidity()) {
                            input.classList.remove('is-invalid');
                        }
                    });
                });
            });
        </script>
    </body>
</html>